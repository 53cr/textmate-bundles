<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple Computer//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>beforeRunningCommand</key>
	<string>nop</string>
	<key>command</key>
	<string>#!/usr/bin/env ruby -wKU

SUPPORT = ENV['TM_SUPPORT_PATH']
DIALOG  = SUPPORT + '/bin/tm_dialog'
PROJECT = ENV['TM_PROJECT_DIRECTORY']
LINE    = ENV['TM_CURRENT_LINE']

require SUPPORT + '/lib/exit_codes'
require SUPPORT + '/lib/escape'
require SUPPORT + '/lib/osx/plist'
require SUPPORT + '/lib/textmate'
require "rexml/document"
require 'find'

#Search for
WORD = STDIN.read.strip

paths = []

TextMate.each_text_file do |file|
	paths.push(file.sub(PROJECT+"/src/","").sub(".as","").gsub( "/", ".")) if File.extname(file) == ".as"
end

TextMate.exit_show_tool_tip "No completion available" if paths.empty?

if !WORD.empty? 
    paths = paths.grep(/#{WORD}/)
end

# paths.each do |line|
#   search_results &lt;&lt; line.strip if line[/#{WORD}/]
# end


paths = paths.collect { |e| { 'title' =&gt; e }}
plist = { 'menuItems' =&gt; paths }.to_plist

res = PropertyList::load(`#{e_sh DIALOG} -up #{e_sh plist}`)

TextMate.exit_discard() unless res.has_key? 'selectedMenuItem'

#if LINE.empty?
if LINE[/import/]
	print res['selectedMenuItem']['title']
else
	print "import " + res['selectedMenuItem']['title'] +";"
end</string>
	<key>fallbackInput</key>
	<string>word</string>
	<key>input</key>
	<string>selection</string>
	<key>keyEquivalent</key>
	<string>~</string>
	<key>name</key>
	<string>Auto Complete Project Imports</string>
	<key>output</key>
	<string>insertAsSnippet</string>
	<key>scope</key>
	<string>source.actionscript3</string>
	<key>uuid</key>
	<string>3B328CDA-E1B7-4CF1-A92C-07430D6F9F99</string>
</dict>
</plist>
